<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ªãƒªãƒ‘å…¨è²·ã„æœŸå¾…å€¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6f6f6;
  padding: 16px;
}
h1 { font-size: 22px; }
input, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  font-size: 16px;
}
button {
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 6px;
}
.card-header, .card-row {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}
.card-header div {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}
.card-row input {
  flex: 1;
  min-width: 0;
}
.result {
  margin-top: 16px;
  padding: 12px;
  background: #000;
  color: #fff;
  border-radius: 6px;
  white-space: pre-line;
}
.prob {
  font-size: 13px;
  color: #333;
  margin-bottom: 4px;
}
</style>
</head>

<body>

<h1>ğŸƒ ã‚ªãƒªãƒ‘å…¨è²·ã„æœŸå¾…å€¤</h1>

<input id="pricePerPack" type="number" placeholder="1å£ã®ä¾¡æ ¼ï¼ˆå††ï¼‰">
<input id="totalPacks" type="number" placeholder="ç·å£æ•°">
<input id="remainingPacks" type="number" placeholder="æ®‹ã‚Šå£æ•°">

<h3>æ’å‡ºã‚«ãƒ¼ãƒ‰</h3>

<div class="card-header">
  <div>ã‚«ãƒ¼ãƒ‰å</div>
  <div>å¸‚å ´ä¾¡æ ¼</div>
  <div>æšæ•°</div>
</div>

<div id="cards"></div>
<button id="addCardBtn">ï¼‹ã‚«ãƒ¼ãƒ‰è¿½åŠ </button>

<h3>ğŸ ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³è³ï¼ˆå††ï¼‰</h3>
<input id="lastOnePrice" type="number" placeholder="ä¾‹ï¼š30000">

<button id="calcBtn">æœŸå¾…å€¤ã‚’è¨ˆç®—ã™ã‚‹</button>

<div id="result" class="result"></div>

<script>
const pricePerPackEl = document.getElementById("pricePerPack");
const totalPacksEl = document.getElementById("totalPacks");
const remainingPacksEl = document.getElementById("remainingPacks");
const lastOnePriceEl = document.getElementById("lastOnePrice");

document.getElementById("addCardBtn").addEventListener("click", addCard);
document.getElementById("calcBtn").addEventListener("click", calculateEV);

function addCard() {
  const wrapper = document.createElement("div");

  const row = document.createElement("div");
  row.className = "card-row";

  const name = document.createElement("input");
  name.placeholder = "Sè³ / Aè³ ãªã©";

  const price = document.createElement("input");
  price.type = "number";
  price.placeholder = "å¸‚å ´ä¾¡æ ¼";

  const count = document.createElement("input");
  count.type = "number";
  count.placeholder = "æšæ•°";

  row.appendChild(name);
  row.appendChild(price);
  row.appendChild(count);

  const prob = document.createElement("div");
  prob.className = "prob";

  wrapper.appendChild(row);
  wrapper.appendChild(prob);

  document.getElementById("cards").appendChild(wrapper);
}

function calculateEV() {
  const totalPacks = Number(totalPacksEl.value);
  const remainingPacks = Number(remainingPacksEl.value);
  const pricePerPack = Number(pricePerPackEl.value);
  const lastOnePrice = Number(lastOnePriceEl.value);

  let expectedValue = 0;

  document.querySelectorAll("#cards > div").forEach(block => {
    const row = block.querySelector(".card-row");
    const probEl = block.querySelector(".prob");

    const name = row.children[0].value || "ä¸æ˜";
    const price = Number(row.children[1].value);
    const count = Number(row.children[2].value);

    if (price > 0 && count > 0) {
      // æ®‹å­˜ç¢ºç‡
      const probRemain = 1 - Math.pow((totalPacks - count) / totalPacks, remainingPacks);
      const percent = (probRemain * 100).toFixed(1);

      probEl.innerText = `${name} æ®‹å­˜ç¢ºç‡ï¼š${percent}%`;

      // æœŸå¾…å€¤
      const expectedRemain = count * (remainingPacks / totalPacks);
      expectedValue += price * expectedRemain;
    }
  });

  const totalCost = pricePerPack * remainingPacks;
  const totalReturn = expectedValue + lastOnePrice;
  const ev = totalReturn - totalCost;

  document.getElementById("result").innerText =
    `æ®‹ã‚Šå½“ãŸã‚ŠæœŸå¾…é¡ï¼š${Math.round(expectedValue).toLocaleString()}å††
æ®‹ã‚ŠæŠ•è³‡é¡ï¼š${totalCost.toLocaleString()}å††
æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ï¼š${Math.round(totalReturn).toLocaleString()}å††
æœŸå¾…å€¤ï¼š${Math.round(ev).toLocaleString()}å††`;
}
</script>

</body>
</html>
