<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ªãƒªãƒ‘å…¨è²·ã„æœŸå¾…å€¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6f6f6;
  padding: 16px;
}
h1 { font-size: 22px; }
input, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  font-size: 16px;
}
button {
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 6px;
}
.card-header, .card-row {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}
.card-header div {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}
.card-row input {
  flex: 1;
  min-width: 0;
}
.checkbox {
  display: flex;
  align-items: center;
  gap: 6px;              /* â† ã“ã‚ŒãŒé‡è¦ */
  font-size: 13px;
  margin-bottom: 6px;
  white-space: nowrap;  /* â† æŠ˜ã‚Šè¿”ã—é˜²æ­¢ */
}
.result {
  margin-top: 16px;
  padding: 12px;
  background: #000;
  color: #fff;
  border-radius: 6px;
  white-space: pre-line;
}
.prob {
  font-size: 13px;
  color: #333;
  margin-bottom: 6px;
}
.mode {
  font-weight: bold;
  margin-bottom: 8px;
}
</style>
</head>

<body>

<h1>ğŸƒ ã‚ªãƒªãƒ‘æœŸå¾…å€¤ãƒ„ãƒ¼ãƒ«</h1>

<input id="pricePerPack" type="number" placeholder="1å£ã®ä¾¡æ ¼ï¼ˆå††ï¼‰">
<input id="totalPacks" type="number" placeholder="ç·å£æ•°">
<input id="remainingPacks" type="number" placeholder="æ®‹ã‚Šå£æ•°">
<input id="purchaseCount" type="number" placeholder="ä»Šå›è³¼å…¥æ•°ï¼ˆä¾‹ï¼š10ï¼‰">

<h3>æ’å‡ºã‚«ãƒ¼ãƒ‰</h3>

<div class="card-header">
  <div>ã‚«ãƒ¼ãƒ‰å</div>
  <div>å¸‚å ´ä¾¡æ ¼</div>
  <div>æšæ•°</div>
</div>

<div id="cards"></div>
<button id="addCardBtn">ï¼‹ã‚«ãƒ¼ãƒ‰è¿½åŠ </button>

<h3>ğŸ ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³è³ï¼ˆå††ï¼‰</h3>
<input id="lastOnePrice" type="number" placeholder="å…¨è²·ã„æ™‚ã®ã¿åŠ ç®—">

<button id="calcBtn">æœŸå¾…å€¤ã‚’è¨ˆç®—ã™ã‚‹</button>

<div id="result" class="result"></div>

<script>
document.getElementById("addCardBtn").addEventListener("click", addCard);
document.getElementById("calcBtn").addEventListener("click", calculateEV);

function addCard() {
  const block = document.createElement("div");

  const row = document.createElement("div");
  row.className = "card-row";

  const name = document.createElement("input");
  name.placeholder = "Sè³ / Aè³ ãªã©";

  const price = document.createElement("input");
  price.type = "number";
  price.placeholder = "å¸‚å ´ä¾¡æ ¼";

  const count = document.createElement("input");
  count.type = "number";
  count.placeholder = "æšæ•°";

  row.appendChild(name);
  row.appendChild(price);
  row.appendChild(count);

  const checkbox = document.createElement("div");
  checkbox.className = "checkbox";
 checkbox.innerHTML = `
  <input type="checkbox">
  <span>æ’å‡ºæ¸ˆã¿ï¼ˆç¢ºå®šï¼‰</span>
`;

  const prob = document.createElement("div");
  prob.className = "prob";

  block.appendChild(row);
  block.appendChild(checkbox);
  block.appendChild(prob);

  document.getElementById("cards").appendChild(block);
}

function calculateEV() {
  const pricePerPack = Number(document.getElementById("pricePerPack").value);
  const totalPacks = Number(document.getElementById("totalPacks").value);
  const remainingPacks = Number(document.getElementById("remainingPacks").value);
  const purchaseCount = Number(document.getElementById("purchaseCount").value);
  const lastOnePrice = Number(document.getElementById("lastOnePrice").value);

  if (purchaseCount <= 0 || purchaseCount > remainingPacks) {
    alert("è³¼å…¥æ•°ã¯1ä»¥ä¸Šã€æ®‹ã‚Šå£æ•°ä»¥ä¸‹ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  let expectedValue = 0;

  document.querySelectorAll("#cards > div").forEach(block => {
    const row = block.querySelector(".card-row");
    const checkbox = block.querySelector("input[type='checkbox']");
    const probEl = block.querySelector(".prob");

    const name = row.children[0].value || "ä¸æ˜";
    const price = Number(row.children[1].value);
    const count = Number(row.children[2].value);

    if (checkbox.checked) {
      probEl.innerText = `${name}ï¼šæ’å‡ºæ¸ˆã¿ï¼ˆç¢ºå®šï¼‰`;
      return;
    }

    if (price > 0 && count > 0) {
      const probRemain =
        1 - Math.pow((totalPacks - count) / totalPacks, remainingPacks);

      probEl.innerText =
        `${name} æ®‹å­˜ç¢ºç‡ï¼š${(probRemain * 100).toFixed(1)}%`;

      const expectedHits = count * (purchaseCount / totalPacks);
      expectedValue += price * expectedHits;
    }
  });

  const cost = pricePerPack * purchaseCount;
  const isAllBuy = purchaseCount === remainingPacks;
  const totalReturn = expectedValue + (isAllBuy ? lastOnePrice : 0);
  const ev = totalReturn - cost;

  document.getElementById("result").innerText =
    `ã€ãƒ¢ãƒ¼ãƒ‰ã€‘
${isAllBuy ? "å…¨è²·ã„ï¼ˆãƒ©ã‚¹ãƒˆãƒ¯ãƒ³å«ã‚€ï¼‰" : "éƒ¨åˆ†è²·ã„"}

ã€æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ã€‘
${Math.round(totalReturn).toLocaleString()}å††

ã€æŠ•è³‡é¡ã€‘
${cost.toLocaleString()}å††

ã€æœŸå¾…å€¤ã€‘
${Math.round(ev).toLocaleString()}å††`;
}
</script>

</body>
</html>
