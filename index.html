<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ªãƒªãƒ‘å…¨è²·ã„æœŸå¾…å€¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6f6f6;
  padding: 16px;
}

h1 { font-size: 22px; }

input, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  font-size: 16px;
}

button {
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 6px;
}

.card-header, .card-row {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}

.card-header div {
  flex: 1;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}

.card-row input {
  flex: 1;
  min-width: 0;
}

.result {
  margin-top: 16px;
  padding: 12px;
  background: #000;
  color: #fff;
  border-radius: 6px;
  white-space: pre-line;
}
</style>
</head>

<body>

<h1>ğŸƒ ã‚ªãƒªãƒ‘å…¨è²·ã„æœŸå¾…å€¤</h1>

<input id="pricePerPack" type="number" placeholder="1å£ã®ä¾¡æ ¼ï¼ˆå††ï¼‰">
<input id="totalPacks" type="number" placeholder="ç·å£æ•°">
<input id="remainingPacks" type="number" placeholder="æ®‹ã‚Šå£æ•°">

<h3>æ’å‡ºã‚«ãƒ¼ãƒ‰</h3>

<div class="card-header">
  <div>ã‚«ãƒ¼ãƒ‰å</div>
  <div>å¸‚å ´ä¾¡æ ¼</div>
  <div>æšæ•°</div>
</div>

<div id="cards"></div>
<button id="addCardBtn">ï¼‹ã‚«ãƒ¼ãƒ‰è¿½åŠ </button>

<h3>ğŸ ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³è³ï¼ˆå††ï¼‰</h3>
<input id="lastOnePrice" type="number" placeholder="ä¾‹ï¼š30000">

<button id="calcBtn">æœŸå¾…å€¤ã‚’è¨ˆç®—ã™ã‚‹</button>

<div id="result" class="result"></div>

<script>
document.getElementById("addCardBtn").addEventListener("click", addCard);
document.getElementById("calcBtn").addEventListener("click", calculateEV);

function addCard() {
  const row = document.createElement("div");
  row.className = "card-row";

  ["ã‚«ãƒ¼ãƒ‰å", "å¸‚å ´ä¾¡æ ¼", "æšæ•°"].forEach((p, i) => {
    const input = document.createElement("input");
    input.placeholder = p;
    if (i > 0) input.type = "number";
    row.appendChild(input);
  });

  document.getElementById("cards").appendChild(row);
}

function calculateEV() {
  const pricePerPack = Number(pricePerPackEl.value);
  const totalPacks = Number(totalPacksEl.value);
  const remainingPacks = Number(remainingPacksEl.value);
  const lastOnePrice = Number(lastOnePriceEl.value);

  let expectedCardValue = 0;

  document.querySelectorAll(".card-row").forEach(row => {
    const price = Number(row.children[1].value);
    const count = Number(row.children[2].value);

    if (!isNaN(price) && !isNaN(count)) {
      const expectedRemaining = count * (remainingPacks / totalPacks);
      expectedCardValue += price * expectedRemaining;
    }
  });

  const totalCost = pricePerPack * remainingPacks;
  const totalReturn = expectedCardValue + lastOnePrice;
  const ev = totalReturn - totalCost;

  document.getElementById("result").innerText =
    `æ®‹ã‚Šå½“ãŸã‚ŠæœŸå¾…é¡ï¼š${Math.round(expectedCardValue).toLocaleString()}å††
æ®‹ã‚ŠæŠ•è³‡é¡ï¼š${totalCost.toLocaleString()}å††
ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³å«ã‚€æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ï¼š${Math.round(totalReturn).toLocaleString()}å††
æœŸå¾…å€¤ï¼š${Math.round(ev).toLocaleString()}å††`;
}

const pricePerPackEl = document.getElementById("pricePerPack");
const totalPacksEl = document.getElementById("totalPacks");
const remainingPacksEl = document.getElementById("remainingPacks");
const lastOnePriceEl = document.getElementById("lastOnePrice");
</script>

</body>
</html>
